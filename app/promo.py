# promo.py
import asyncio
from aiogram import Bot
from app.db import is_promo_sent, mark_promo_sent, get_user_first_name

PROMO_DELAY_SECONDS = 24 * 60 * 60  # 24 —á–∞—Å–∞


async def schedule_promo(bot: Bot, chat_id: int, telegram_id: int):
    # –ñ–¥—ë–º 24 —á–∞—Å–∞
    await asyncio.sleep(PROMO_DELAY_SECONDS)

    # –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –µ—â—ë —Ä–∞–∑ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –ª–∏ —Ä–µ–∫–ª–∞–º—É
    if is_promo_sent(telegram_id):
        return

    first_name = get_user_first_name(telegram_id)

    text = (
        f"{first_name}, –ø—Ä–∏–≤–µ—Ç! "
        "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –≤—Ä–µ–º—è –∏ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –≤–ª–æ–∂–∏–ª–∏ –≤ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –º–æ–µ–≥–æ –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞ ¬´–°–≤–µ—Ç–æ—Ñ–æ—Ä¬ª.\n\n"
        "–í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –ø–æ–º–æ–≥–ª–∏ —É–≤–∏–¥–µ—Ç—å –≤–∞—à–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ò —Ç–µ–ø–µ—Ä—å, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –æ—Ç –æ—Å–æ–∑–Ω–∞–Ω–∏—è –∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, "
        "—è –ø—Ä–∏–≥–ª–∞—à–∞—é –≤–∞—Å –Ω–∞ 30-–º–∏–Ω—É—Ç–Ω—É—é –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—É—é —Å–µ—Å—Å–∏—é –ø–æ –º–µ—Ç–æ–¥—É –¢–µ—Ç–∞-—Ö–∏–ª–∏–Ω–≥.\n\n"
        "–ö–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç:\n\n"
        "‚úÖ –ï—â–µ —Ä–∞–∑ –ø–æ—Å–º–æ—Ç—Ä–∏–º –≤ –≤–∞—à–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏–º –∫–ª—é—á–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã.\n"
        "‚úÖ –ú—è–≥–∫–æ —Å–Ω–∏–º–µ–º —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ª–æ–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤ —Ç–µ—Ç–∞-—Å–æ—Å—Ç–æ—è–Ω–∏–∏.\n"
        "‚úÖ –û–±–æ–∑–Ω–∞—á–∏–º –≤–∞—à–∏ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –∫ —è—Å–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—é –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏—Ö –≤–∞—Å –≤–æ–ø—Ä–æ—Å–æ–≤.\n\n"
        "–û–ø–ª–∞—Ç–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –≠—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç ‚Äî –º–æ—è –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤–∞—à–µ –¥–æ–≤–µ—Ä–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –ø–æ–∫–∞–∑–∞—Ç—å, "
        "–∫–∞–∫ —Ç–µ—Ç–∞-—Ö–∏–ª–∏–Ω–≥ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–µ—à–∞—Ç—å –∏–º–µ–Ω–Ω–æ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏.\n\n"
        "–ï—Å–ª–∏ –≤—ã –≥–æ—Ç–æ–≤—ã –∫ –ª–∏—á–Ω–æ–π –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–µ, —á—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–∏—Ç—å —Å–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî "
        "–∑–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –Ω–∞—à–µ–π –≤—Å—Ç—Ä–µ—á–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.\n\n"
        "üëâ @psihologos_ru\n\n"
        "–° –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ–º –∂–¥—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—à–µ–π –≤—Å—Ç—Ä–µ—á–∏!\n\n"
        "–° —Ç–µ–ø–ª–æ–º –∏ —É–≤–∞–∂–µ–Ω–∏–µ–º,\n"
        "–ú–∞—Ä–∏–Ω–∞ –ß–µ—Ä–≤–∞–∫–æ–≤–∞."
    )


    try:
        await bot.send_message(chat_id, text)
        mark_promo_sent(telegram_id)
    except Exception:
        # —Ç—É—Ç –º–æ–∂–Ω–æ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å
        pass
